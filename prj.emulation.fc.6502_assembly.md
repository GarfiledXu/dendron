---
id: 18h3a70hrri6ksvovpxqcs9
title: 6502_assembly
desc: ''
updated: 1768469248870
created: 1766456915812
---

## outline

0. 基础概念和知识
1. cpu的工作流程和原理
2. 核心指令集
3. 编写结构化的程序
4. 完整程序代码阅读
5. cpu模拟的实现思路

## 内存 总线 cpu 寄存器 指令 硬件软件的概念边界

1. 区分物理硬件，逻辑概念，软件协议
   1. 内存：准确来说是内存芯片，属于物理硬件，提供易失性存储功能，由cpu或者其他硬件模块通过物理总线进行访问
   2. cpu：同内存也是物理硬件，通过总线读取数据和指令进行处理
   3. 寄存器：存在于cpu内部的硬件模块
   4. 总线（bus）：硬件模块间沟通的桥梁，是共享的物理信号线路，fc涉及的总线分为三类，`地址总线` `数据总线` `控制总线`，是一种基础的系统总线协议
      1. 总线体系的分层模型：
         1. fc的系统总线与现代计算机常见的总线，比如pcie和usb 这些总线模型本质区别在哪？
         2. 模糊理解：总线在计算机发展历史中是一个泛化的概念，早期表示`一组模块间共享的物理信号线，功能是单一明确的，与物理线路的对应关系是1v1`，后期演变为`物理介质+完整分层的硬件和软件协议`
         3. 准确解释：
            1. 并行 串行 以及分时复用
               1. 软件相关模型中的并行和串行，通常表示在某个时刻的工作单位或者处理单位的数量 是多个还是单个，即时间和处理单位的关系
               2. 总线中并行和串行类别的含义，首先得明确物理硬件通过单个线路的电平高低表示1 bit数值，再通过时间和空间上多个bit的组合来表示基本的单位数据如字节，而假定一个最小时间片内，物理线路表达（采样锁存，驱动保持）bit数量决定总线串并类型，大于1则是并行，即使物理线路的数量与bit数量不对等，只要大于1即算并行（例如4组物理线路，分时复用两个时间片，将一个字节的8bit分两次表示），而分时复用即 相同的线路或者处理单元在不同的时刻，执行不同的处理逻辑
            2. cpu和总线
               1. 回到了总线是什么，是连接了一个完整硬件系统中各模块的物理线路，以及对应的数据操作规则集合
               2. cpu决定了总线的哪些规则，数据宽度，通信模型（主控和外设的通信关系），时序模型（发送通信时，在时间维度上各角色间的行动规则），基本的操作语义（解释读写行为所表达的意义）
            3. 总线的归类
               1. 按照其作用范围
                  1. 系统总线：cpu和系统核心部件的通信
                  2. 片上总线：芯片内部模块间的通信
                  3. 扩展/外设总线：系统与外部设备的连线
                  4. 设备内部总线：一个设备内部子模块的总线
               2. 按照总线逻辑协议的抽象程度
                  1. non-protocol/signal bus 裸信号总线：依靠时序硬编码驱动总线交互，几乎没有协议
                  2. transaction bus 事务总线：抽象出事务逻辑，由状态驱动总线交互；即裸信号总线是没有状态逻辑参与的，时序到了则执行
                  3. networked bus 网络化总线：高度的抽象和封装，存在包，帧数据的概念，总线的访问抽象为了 消息在节点间的传输
         4. 为何fc的系统总线 是裸信号，并行？
            1. 主要是由技术发展程度以及成本考量
   5. 指令是什么？
      1. 模糊理解：指令是抽象出来的cpu行为规则集合
      2. 本质上是由一组在cpu架构时预先定义的 从外部输入到cpu识别并执行的操作语义，这组操作语义映射到软件层面则抽象为具体的编码符号

## cpu的工作流程和原理

 cpu本质上是一个时钟驱动的有限状态机，重复执行“输入-状态-输出”的过程操作

### clock and cycle 时钟和周期在硬件层面的具象化

1. 时钟更准确的称呼应该是时钟信号，构成时钟系统的角色：时钟信号，时钟源，时钟信号线
2. 通过时钟信号线传递时钟信号，该信号本质上就是按固定频率翻转的电平信号，在波形上表现为方波
3. 为什么要需要固定频率翻转的信号？翻转的瞬间即`边沿触发`，可以被特定组合器件（边沿触发寄存器）采样来作为触发特定操作的条件，因此整个硬件系统就可以通过时钟信号，让元器件之间达成某种程度的同步执行
4. 更准确来说，时钟信号，为整个系统同步/统一的是什么？同步的是状态更新/采样的时刻，为系统中的所有状态元件，提供了统一的状态采样时间点
5. cycle是什么？clock是连续的物理信号，而cycle则是在这基础上，抽象的时间单位是时间长度，具体为`两个连续且同类型时钟边沿之间的时间间隔`

### 系统总线的交互过程

1. 在物理层面总线只是一堆连接线路，并主控芯片，那么整个总线的交互过程，是由谁控制？
   1. 总线本身并不具备主动性，无法主动交互，是被动的，而是芯片进行总线的`驱动和采样`
2. 三态缓冲器 地址译码 片选信号
3. 总线冲突是如何避免的？
4. 总线 内存 地址

### instruction fetch 取指

取指而非取址

1. instruction fetch是什么？
   是指在程序执行过程中，cpu从内存中指令编码（opecode/operand），锁存到指令寄存器（IR:instruction register）中，并准备执行的过程
   涉及角色：cpu，内存，总线，时钟，寄存器，存储器等
2. 硬件部件详解
   1. register：寄存器本身是由多个边沿触发D触发器组成的存储单元，存储单元每一个bit位的表示：时钟边沿发生时采样/更新： D（输入）-> Q（输出）
   2. PC(program counter) register：这个寄存器存储的是下一条指令在内存中的地址，而 `PC + 1`的操作则表示存储地址自增更新，通过在硬件上加入`加法器`实现
   3. IR(instruction register)：用于锁存从内存中读取出来的实际指令编码（opecode/operand）
   4. 什么叫做锁存？在时钟信号边沿发生时，硬件部件将当前电平输入进行`快照`，存储进寄存器
   5. memory 存储器：
   6. address bus 地址总线
   7. data bus 数据总线
   8. contorl bus 控制总线



### decode 译码

### execute 执行

### micro-ops

### 控制流的实现机制

### read/write 内存访问流程

### 堆栈和子程序

### 中断和异常

## 地址以及寻址操作的表示方式

1. `$` 数值的表示方式(16进制数)
2. `#` 寻址方式的标记(立即寻址)
   1. 为什么读取立即数值叫做立即寻址？
      1. 立即寻址，零页寻址，绝对寻址，每种寻址方式对应着唯一opcode
      2. 从cpu的角度，寻址方式择，cpu没有选择权力，不会根据输入数值进行切换和优化
