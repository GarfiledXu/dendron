---
id: 450dojvyubno6fx4h960krr
title: Platform
desc: ''
updated: 1721115583579
created: 1710814803044
---

#### 新路历程
先解释一下，目前几个平台的基本结构，给不太了解的小伙伴介绍情况

一句话描述我们的定位:
高情商: 面向平台的设备端代理
低情商: 端茶送水搬砖监视 

让平台做好业务上的数据管理

内部实现: 逐渐状态机化

现有所有的方案 对比

现状

考量
adb本质上就是一个安卓设备端的服务

设备端的差异，能有多大？
业务端的差异，能有多大？
testbed逻辑的差异，能有多大？



内部的实现架构，如何监控testbed 进程，如何做并行化
具体模块: 
分跨平台过程中的通用模块，以及差异性模块
日志模块(如何 滚动，如何压缩，如何回传，支持哪些协议，如何管理testbed日志，进程间如何传递 一些标志设置(通过环境变量进行透传))
文件处理, 磁盘与内存状况监控
内部缓冲
抽象层
状态机
涉及协议: rabbitmq,http,websocket，mqtt，samba



### 如何去缩短整条链路，为testbed方提供一个模拟环境



### 状态机 完全剥离协议，支持直接进程间通信自测

### 是server-client模式(http), 还是remote call (RPC)?


#### 核心的感悟还是: 1. 单元测试 2.稳定自测 3.接口的回归验证
依赖的东西越多，那么你单元测试的环境实际上不可能纯粹，虽然可以切换case，但一般情况下所有的case的编译是统一的，所以换条路，将命令行与函数调用形成最直接的映射, 最终版本是静态全局注册到命令行解析框架中，相比全面的单元测试，根据灵活性，脱离了测试代码，只在接口实现处有关联

### 核心 如何测试


### 核心 提供的交互方式有多少

### 任务类型驱动 状态驱动 交互

#### 介绍通信模型 ，最终的选型与考虑
https://www.enterpriseintegrationpatterns.com/patterns/messaging/CompetingConsumers.html
point to point channel
https://www.enterpriseintegrationpatterns.com/patterns/messaging/RequestReply.html
1. 同步阻塞
2. 异步回调：发送消息前设置好对应响应的回调，只需要确保消息被对方接收处理即可
3. 异步轮询：发送消息后进行主动轮询，状态由被调用者提供


#### 文档准备
- [ ] 类
- [ ] 时序图
- [ ] 需求文档


#### 思考
##### 在开发过程中如何插入更多的测试保障，健壮代码质量
一个模块今天可能没事
明天可能就有事，这个时候该怎么办？

##### 个人经历
toycb 接口测试
舱内sdk 接口测试
最早都是 chen安排我这边做的
但我的内心还是有抗拒了，这活干着总有种在脱裤子放屁的感觉，你成品都交付给客户了，都装车了，你现在告诉我需要我这边为你每一个接口写单元测试，只负责生不负责养
让我这幼小心灵上特殊感觉
但如果换一种角度呢，作为一个具体项目的一名开发者 测试 在整个开发中的占比，以及重要性，到底有多大?
可有可无？写完了守株待兔
主动出击，编写具体的单元测试


但如果是一个完备的测试用例，那么工作量将不亚于项目的功能开发，甚至几倍
所以我们通常要思考的是，我们应该以一个什么样的优先级以及层次，对自己开发的项目 进行功能验证，单元测试，甚至全自动化测试

#### 今天的主题可能还是聚焦在这两个角度 开发 与 测试

#### 开发是核心，但测试可能是两倍的核心，占到总时间的一半
1. 快速验证
2. 完备且层级分明的单元测试
3. 集成模拟测试
4. 正式测试

#### 关于类型转换
很多情况下，为了对接口进行抽象，统一，需要运行时的参数去类型
用c语言的话说就是void*
用c++的话说就是Any

#### 如何主动出击，一个项目开发的完整性
相信这其实在座各位都在做的事情，
假设缺陷的存在
如何去找到缺陷，如何去复现缺陷，如何在一个新平台上以最快的速度验证所有测试用例，确保移植的一致性

还是那句话，以我的个人经历
#### 有趣的经历感受
tongfei拿到项目后，实际上做的事情是 自定向下的拆，而不是接
#### 总结
从项目维护者的角度来说这就是开发任务, 能让项目真正有延续生命力的源头

#### 看看开源项目是如何做的
##### 举例 imgui 的移植
qnx  源码内含的大量接口测试
##### 反例: amqpcpp
使用后出现了大量的异常，除了接口封装的漂亮吸引人意外，作为一个白嫖党来说我觉得非常糟糕
##### samba
有着详细的测试


#### 命令行服务组合
可以以线程，进程的方式自由组合


#### platform作用
预定义合法的平台
并在真实设备的配置文件里定义合法的平台信息
运行时进行判断，选择对应的逻辑
