---
id: m8juc4sryy22srrmpn37fma
title: Auto_test_competition
desc: ''
updated: 1703987295275
created: 1703911048768
---

### summary
- 程序使用介绍
  - 点击程序二进制文件
  - 按提示输入 存放jpg的文件夹，以及输出直方图的文件夹
  - enter 以后自动处理所有jpg
  - 运行结果
    - 控制台会输出处理 jpg的总量，以及所有jpg从io读入到最终直方图io写入的耗时
    - 以及每一张jpg图片，每一个阶段(io读入，转灰度图，计算直方图数据，直方图绘制，io写入)的处理耗时
- 程序处理流程层级
  - 遍历输入文件夹，获得jpg文件列表
  - 对列表中的文件进行以下完整处理
      - 单张jpg的处理流程
        - jpg io从磁盘加载到内存，并解码获得RGB图像数据
        - 对RGB图像数据进行灰度化
        - 统计灰度图像的灰度数据
        - 使用灰度数据生成对应的直方图图像数据
        - 直方图图像数据 io写入到磁盘
- 任务单位划分
- 方案
    1. 对于每一张
    1. 单线程处理
        - 在一个线程内，依次处理每一张图片，顺序执行所有步骤
    2. 多线程处理
        - 每个线程负责一个jpg集合的处理
        - 在单张jpg处理的环节，进行多线程处理
        1. 线程组
           1. 手动划分处理集合，分配给实例化的线程组成员
           2. 缺点:对于均等的任务数量，线程消费速度有高低，最终会存在有线程提前消费等待其他线程情况，存在性能浪费 
        2. 线程池 流水线式
           1. 对于实例化的线程组，当任务饱和时能所有线程可以均匀消化任务
        3. openmp  
           1. 通过编译指令注入的方式，代码非入侵，并且
- 测试
  - 对单次的图像灰度转化，以及灰度计算直方图数据的数组处理进行并行处理
    - 结论：适得其反，似乎并行化后的最终的开销已经大于了直接单线程处理，所以这里不进行优化
- 分析
    - 耗时集中在 jpg图像加载
    - 图像灰度转化，以及灰度计算直方图数据，以及直方图数据写入jpg，耗时基本在5ms以内
- 方案优化
  - 取消在单个图像数据，灰度转化以及直方图数据生成步骤中的并行计算，一个线程独立完成完整步骤
  - 使用openmp 来替换线程池方案, 提升整体的消费速度, 优点: 通过编译指令的形式注入，代码非入侵，加上就是多线程，去掉就是单线程

- 最终数据
  